<!DOCTYPE html>
<html>
<head>
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º {{ service_name }}</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .active { background-color: #d4edda; color: #155724; }
        .inactive { background-color: #f8d7da; color: #721c24; }
        .buttons { margin: 20px 0; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-start { background-color: #28a745; color: white; }
        .btn-stop { background-color: #dc3545; color: white; }
        .btn-restart { background-color: #ffc107; color: black; }
        .btn-disabled { opacity: 0.5; cursor: not-allowed; }
        .access-control { margin: 20px 0; }
    </style>
</head>
<body>
    <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º: {{ service_name }}</h1>
    
    <div class="status {% if status == 'active' %}active{% else %}inactive{% endif %}">
        –°—Ç–∞—Ç—É—Å: <strong>{{ status }}</strong>
    </div>
    
    <div class="access-control">
        <label>
            <input type="checkbox" id="accessToggle" {% if access_allowed %}checked{% endif %}>
            –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à—ë–Ω
        </label>
    </div>
    
    <div class="buttons">
        <button id="btnStart" class="btn-start {% if not access_allowed %}btn-disabled{% endif %}" 
                {% if not access_allowed %}disabled{% endif %}>–ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
        <button id="btnStop" class="btn-stop {% if not access_allowed %}btn-disabled{% endif %}" 
                {% if not access_allowed %}disabled{% endif %}>–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
        <button id="btnRestart" class="btn-restart {% if not access_allowed %}btn-disabled{% endif %}" 
                {% if not access_allowed %}disabled{% endif %}>–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
    </div>
    
    <div id="message"></div>

    <div class="api-info">
    <div class="api-title">üì° API Documentation</div>
    <div style="margin-bottom: 20px;">
        <a href="/swagger/" target="_blank" style="display: inline-block; 
           background: #007bff; color: white; padding: 10px 15px; 
           border-radius: 5px; text-decoration: none; margin-right: 10px;">
            üìñ Swagger UI
        </a>
        <a href="/redoc/" target="_blank" style="display: inline-block; 
           background: #85ea2d; color: white; padding: 10px 15px; 
           border-radius: 5px; text-decoration: none;">
            üìö ReDoc
        </a>
    </div>
    <!-- –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ API endpoints -->
</div>

    <script>
    document.getElementById('accessToggle').addEventListener('change', function() {
        fetch('/api/toggle-access/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            location.reload();
        });
    });

    document.getElementById('btnStart').addEventListener('click', () => controlService('start'));
    document.getElementById('btnStop').addEventListener('click', () => controlService('stop'));
    document.getElementById('btnRestart').addEventListener('click', () => controlService('restart'));

    function controlService(action) {
        if (!document.getElementById('accessToggle').checked) {
            showMessage('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø —Å–Ω–∞—á–∞–ª–∞.', 'error');
            return;
        }

        fetch(`/api/control/${action}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            showMessage(data.message, data.status);
            if (data.status === 'success') {
                setTimeout(() => location.reload(), 1000);
            }
        });
    }

    // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    function showMessage(text, type) {
        const messageDiv = document.getElementById('message');
        messageDiv.innerHTML = `<div class="status ${type === 'success' ? 'active' : 'inactive'}">${text}</div>`;
        setTimeout(() => messageDiv.innerHTML = '', 3000);
    }

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>
</body>
</html>